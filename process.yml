version: 2
jobs:
  build:
    docker:
    - image: circleci/php:7.4-node-browsers
    steps:
    - run:
        command: echo pwd
    - add_ssh_keys:
        fingerprints:
        - 34:22:25:fb:07:d6:d6:83:9c:4e:54:1f:c4:81:b2:c3
    - checkout
    - run: sudo apt update
    - run: sudo docker-php-ext-install zip
    - restore_cache:
        keys:
        - v1-dependencies-{{ checksum "composer.json" }}
        - v1-dependencies-
    - run: composer install -n --prefer-dist
    - save_cache:
        key: v1-dependencies-{{ checksum "composer.json" }}
        paths:
        - ./vendor
    - restore_cache:
        keys:
        - node-v1-{{ checksum "package.json" }}
        - node-v1-
    - run: yarn install
    - save_cache:
        key: node-v1-{{ checksum "package.json" }}
        paths:
        - node_modules
    - run: touch storage/testing.sqlite
    - run: php artisan migrate --env=testing --database=sqlite_testing --force
    - run: ./vendor/bin/codecept build
    - run: ./vendor/bin/codecept run
    environment:
    - CIRCLE_COMPARE_URL: https://github.com/mudithalasantha/laravel-medialibrary/compare/c27511f59075cad2ce55434f4ec581004325065e...c27511f59075cad2ce55434f4ec581004325065e
workflows:
  version: 2
  workflow:
    jobs:
    - build
